# 后端架构设计

## 一、技术栈选择

*   **编程语言：** Java (JDK 17)
*   **后端框架：** Spring Boot (3.4.3)
*   **AI 集成：** Spring AI (spring-ai, spring-ai-alibaba)
*   **数据库：** MySQL (关系型数据库，适合结构化数据存储)
*   **ORM 框架：** Mybatis-Plus (简化数据库操作)
*   **认证授权：** JWT + Spring AOP (利用切面进行鉴权)
*   **API 接口：** 封装大语言模型 API 和语音识别 API 的调用。
*   **接口文档：** Knife4j

## 二、模块划分

1.  **用户服务 (User Service)：**
    *   负责用户注册、登录、用户资料管理、权限管理。
    *   提供用户认证和授权接口。

2.  **行程服务 (Travel Plan Service)：**
    *   负责行程的创建、查询、修改、删除。
    *   与 AI 服务交互，调用大语言模型 API 生成个性化行程。
    *   提供行程的云端同步功能。

3.  **费用服务 (Expense Service)：**
    *   负责旅行开销的记录、查询、统计。
    *   提供预算分析功能。

4.  **AI 服务 (AI Service)：**
    *   封装阿里云百炼大语言模型 API 的调用，提供智能行程规划和预算分析能力。
    *   封装语音识别 API 的调用，提供语音输入处理能力。

5.  **数据存储服务 (Data Storage Service)：**
    *   负责与 MySQL 数据库的交互，提供数据持久化。


## 三、API 设计

*   **API 风格：** 采用 RESTful API 风格，提供清晰、规范的接口。
*   **API 文档：** 使用 Swagger/OpenAPI 生成和管理 API 文档，方便前后端协作。

## 四、数据模型 (示例)

1.  **用户 (User)：**
    *   `id` (主键)
    *   `username` (用户名)
    *   `password` (加密后的密码)
    *   `email` (邮箱)
    *   `registration_time` (注册时间)

2.  **行程 (TravelPlan)：**
    *   `id` (主键)
    *   `user_id` (外键，关联用户)
    *   `plan_name` (行程名称)
    *   `destination` (目的地)
    *   `start_date` (开始日期)
    *   `end_date` (结束日期)
    *   `budget` (预算)
    *   `travelers` (同行人数)
    *   `preferences` (旅行偏好)
    *   `details` (详细行程，可存储为 JSON 格式，包含交通、住宿、景点、餐厅等信息)

3.  **费用 (Expense)：**
    *   `id` (主键)
    *   `user_id` (外键，关联用户)
    *   `travel_plan_id` (外键，关联行程)
    *   `type` (费用类型，如交通、餐饮、住宿等)
    *   `amount` (金额)
    *   `description` (备注)
    *   `expense_time` (发生时间)

## 五、部署方案

*   **Docker 容器化：** 将后端服务打包成 Docker 镜像，方便部署和管理。
*   **CI/CD：** (可选) 搭建持续集成/持续部署流程，自动化构建、测试和部署。

## 六、安全性考虑

*   **API Key 管理：** API Key 不硬编码，通过配置文件或环境变量进行管理。
*   **密码加密：** 用户密码进行加密存储，例如使用 BCrypt。
*   **API 访问控制：** 对敏感 API 接口进行权限控制，确保只有授权用户才能访问。
*   **输入校验：** 对所有用户输入进行严格的校验，防止 SQL 注入、XSS 等攻击。